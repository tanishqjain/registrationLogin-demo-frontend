<html>

	<head>

		<title>OIDC Error Page | demo.gigya.com</title>

		<style>
		/* ** --snipped-- ** */
		</style>

	</head>

	<body>

		<h2>Gigya OIDC OP Error Page</h2>
		
		<div class="responseDiv" id="responseDiv" style="width: 95%; height: 50%; overflow: auto; text-align: left; margin: 0px auto;">
		
		</div>
		
		<script>
		
		const urlParams = new URLSearchParams(window.location.search);
		const errMessage = urlParams.get('message');
		const errCode = urlParams.get('code');
		console.log(`OIDC Error | ${errCode} | ${errMessage}`)

		if (window.self === window.top) {
			// The error page is loaded as a standalone page in redirect flow
			const returnUrl = localStorage.getItem('returnUrl')
			const localeCountry = localStorage.getItem('localeCountry')
			var redirectUrl = returnUrl ? truncateURL(returnUrl, localeCountry) : "https://www.electrolux.co.uk/";
			
			//protection for AMW
			if(redirectUrl.indexOf('shop') === -1){
				window.location.href = redirectUrl+"/errors/application-error/";
			}
		
		} else {
			// The error page is loaded inside an iframe in pop-up flow
			var message = {
				dataName: 'OIDC error, please redirect to error page',
				dataType: 'Error',
				dataID: 'ERROIDCTokenExpiry02'
			};	
			window.top.postMessage(message, '*');
		}

		function truncateURL(url, localeCountry) {
			// In case root domain of current website contains market details
			const localeCountryIndex = url.indexOf(localeCountry);
			if (localeCountryIndex !== -1) {
				return url.substring(0, localeCountryIndex + 5);
			}

			// In case root domain of current website doe not contains market details
			const slashIndex = url.indexOf('/', url.indexOf('//') + 2);
			if (slashIndex !== -1) {
				return url.substring(0, slashIndex);
			}
		}
		
			// thisUri = window.location.href;
			
			// thisUriToDelete= window.location.protocol + "//" + window.location.hostname + "/error.html?";
			
			// decodedUri = decodeURIComponent(thisUri);
			
			// decodedUri = decodedUri.replace(thisUriToDelete, "");
			
			// decodedUri = decodedUri.replace(/,/g, ",<br /> ");
			
			// decodedUri = decodedUri.replace(/{/g, "{<br /> ");
			
			// decodedUri = decodedUri.replace(/}/g, "<br />}");
			
			// decodedUri = decodedUri.replace(/&/g, "<br />");
			
			// document.getElementById('responseDiv').innerHTML = decodedUri;
		
		</script>

	</body>

</html>